from flask import Flask, request, jsonify

app = Flask(__name__)

@app.route('/', methods=['GET', 'POST'])
def main():
    # Required for Transfer-Encoding support in the request
    request.environ['wsgi.input_terminated'] = True

    # Create headers dictionary
    headers = {}
    for header in request.headers:
        headers[header[0]] = header[1]

    # Decode request.data safely
    try:
        body = request.data.decode('utf-8')
    except UnicodeDecodeError:
        body = request.data.hex()  # fallback to hex if it's not valid UTF-8

    return jsonify(
        body=body,
        headers=headers
    )

if __name__ == '__main__':
    app.run(debug=True)

